<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç¦ç¬‘ã„ãƒ‡ãƒ¢</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .main-area {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      /* ã‚«ãƒ¡ãƒ©ã‚¨ãƒªã‚¢ */
      .camera-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .camera-section h2 {
        color: #ff6b6b;
        margin-bottom: 15px;
      }

      #video-container {
        position: relative;
        width: 320px;
        height: 240px;
        border: 3px solid #ff6b6b;
        border-radius: 12px;
        overflow: hidden;
        background: #000;
      }

      #input_video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
      }

      #output_canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: scaleX(-1);
      }

      #capture-btn {
        display: block;
        width: 100%;
        padding: 12px;
        margin-top: 15px;
        background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
      }

      #capture-btn:hover {
        transform: translateY(-2px);
      }

      #status {
        margin-top: 10px;
        padding: 8px;
        background: #f0f0f0;
        border-radius: 6px;
        text-align: center;
        font-size: 14px;
      }

      #status.active {
        background: #d4edda;
        color: #155724;
      }

      /* ç¦ç¬‘ã„ã‚¨ãƒªã‚¢ */
      .fukuwarai-section {
        flex: 1;
        min-width: 500px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .fukuwarai-section h2 {
        color: #ff6b6b;
        margin-bottom: 15px;
      }

      .fukuwarai-container {
        display: flex;
        gap: 20px;
      }

      /* é¡”ã®è¼ªéƒ­ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ï¼‰ */
      #face-canvas {
        width: 400px;
        height: 500px;
        border: 3px dashed #ffb6c1;
        border-radius: 50%;
        background: #fff5f5;
        position: relative;
      }

      /* ãƒ‘ãƒ¼ãƒ„ç½®ãå ´ */
      .parts-tray {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 15px;
        background: #fff0f0;
        border-radius: 12px;
        min-width: 150px;
      }

      .parts-tray h3 {
        font-size: 14px;
        color: #666;
        text-align: center;
        margin-bottom: 5px;
      }

      /* ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒ‘ãƒ¼ãƒ„ */
      .draggable-part {
        cursor: grab;
        border: 2px solid #ffb6c1;
        border-radius: 8px;
        background: white;
        padding: 5px;
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .draggable-part:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .draggable-part.dragging {
        opacity: 0.8;
        cursor: grabbing;
        z-index: 1000;
      }

      .draggable-part canvas {
        display: block;
        max-width: 100%;
      }

      .draggable-part span {
        font-size: 12px;
        color: #666;
      }

      /* é¡”ã®ä¸Šã«é…ç½®ã•ã‚ŒãŸãƒ‘ãƒ¼ãƒ„ */
      .placed-part {
        position: absolute;
        cursor: grab;
        transition: box-shadow 0.2s;
      }

      .placed-part:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }

      .placed-part.dragging {
        cursor: grabbing;
        z-index: 1000;
      }

      /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
      .controls {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .controls button {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .controls button:hover {
        transform: translateY(-2px);
      }

      #reset-btn {
        background: #ffd93d;
        color: #333;
      }

      #save-btn {
        background: #6bcb77;
        color: white;
      }

      #shuffle-btn {
        background: #4d96ff;
        color: white;
      }

      /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        text-align: center;
        z-index: 10000;
      }

      #loading.hidden {
        display: none;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #ff6b6b;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .instructions {
        background: #fff3cd;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        font-size: 14px;
        color: #856404;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="spinner"></div>
      <p>ã‚«ãƒ¡ãƒ©ã¨MediaPipeã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <div class="container">
      <h1>ğŸ­ ç¦ç¬‘ã„</h1>

      <div class="main-area">
        <!-- ã‚«ãƒ¡ãƒ©ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="camera-section">
          <h2>ğŸ“· é¡”ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£</h2>
          <div id="video-container">
            <video id="input_video" autoplay playsinline></video>
            <canvas id="output_canvas"></canvas>
          </div>
          <button id="capture-btn">ğŸ“¸ ãƒ‘ãƒ¼ãƒ„ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£</button>
          <div id="status">å¾…æ©Ÿä¸­...</div>
        </div>

        <!-- ç¦ç¬‘ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="fukuwarai-section">
          <h2>ğŸ¯ ç¦ç¬‘ã„ã§éŠã¼ã†</h2>
          <div class="instructions">
            ğŸ’¡ ãƒ‘ãƒ¼ãƒ„ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é¡”ã®ä¸Šã«é…ç½®ã—ã‚ˆã†ï¼
          </div>
          <div class="fukuwarai-container">
            <!-- ãƒ‘ãƒ¼ãƒ„ç½®ãå ´ -->
            <div class="parts-tray" id="parts-tray">
              <h3>ãƒ‘ãƒ¼ãƒ„</h3>
              <div class="draggable-part" data-part="leftEye">
                <canvas id="tray-left-eye" width="80" height="40"></canvas>
                <span>å·¦ç›®</span>
              </div>
              <div class="draggable-part" data-part="rightEye">
                <canvas id="tray-right-eye" width="80" height="40"></canvas>
                <span>å³ç›®</span>
              </div>
              <div class="draggable-part" data-part="nose">
                <canvas id="tray-nose" width="60" height="60"></canvas>
                <span>é¼»</span>
              </div>
              <div class="draggable-part" data-part="mouth">
                <canvas id="tray-mouth" width="80" height="40"></canvas>
                <span>å£</span>
              </div>
              <div class="draggable-part" data-part="leftEyebrow">
                <canvas id="tray-left-eyebrow" width="80" height="30"></canvas>
                <span>å·¦çœ‰</span>
              </div>
              <div class="draggable-part" data-part="rightEyebrow">
                <canvas id="tray-right-eyebrow" width="80" height="30"></canvas>
                <span>å³çœ‰</span>
              </div>
            </div>

            <!-- é¡”ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <div id="face-canvas"></div>
          </div>

          <div class="controls">
            <button id="shuffle-btn">ğŸ² ã‚·ãƒ£ãƒƒãƒ•ãƒ«é…ç½®</button>
            <button id="reset-btn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            <button id="save-btn">ğŸ’¾ ç”»åƒã‚’ä¿å­˜</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { FilesetResolver, FaceLandmarker } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest";

      const videoElement = document.getElementById("input_video");
      const canvasElement = document.getElementById("output_canvas");
      const canvasCtx = canvasElement.getContext("2d");
      const status = document.getElementById("status");
      const loading = document.getElementById("loading");
      const captureBtn = document.getElementById("capture-btn");
      const faceCanvas = document.getElementById("face-canvas");
      const partsTray = document.getElementById("parts-tray");

      // ãƒ‘ãƒ¼ãƒ„ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹
      const trayCanvases = {
        leftEye: document.getElementById("tray-left-eye"),
        rightEye: document.getElementById("tray-right-eye"),
        nose: document.getElementById("tray-nose"),
        mouth: document.getElementById("tray-mouth"),
        leftEyebrow: document.getElementById("tray-left-eyebrow"),
        rightEyebrow: document.getElementById("tray-right-eyebrow"),
      };

      let faceLandmarker = null;
      let lastVideoTime = -1;
      let currentLandmarks = null;
      let placedParts = [];

      // FaceMeshã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
      const FACE_PARTS = {
        leftEye: [33, 7, 163, 144, 145, 153, 154, 155, 133, 173, 157, 158, 159, 160, 161, 246],
        rightEye: [362, 382, 381, 380, 374, 373, 390, 249, 263, 466, 388, 387, 386, 385, 384, 398],
        nose: [1, 2, 98, 327, 168, 6, 197, 195, 5, 4, 19, 94, 370],
        mouth: [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 308, 324, 318, 402, 317, 14, 87, 178, 88, 95],
        leftEyebrow: [70, 63, 105, 66, 107, 55, 65, 52, 53, 46],
        rightEyebrow: [300, 293, 334, 296, 336, 285, 295, 282, 283, 276],
      };

      // MediaPipe Face Landmarkerã®åˆæœŸåŒ–
      async function initializeFaceLandmarker() {
        const vision = await FilesetResolver.forVisionTasks(
          "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"
        );

        faceLandmarker = await FaceLandmarker.createFromOptions(vision, {
          baseOptions: {
            modelAssetPath:
              "https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",
            delegate: "GPU",
          },
          runningMode: "VIDEO",
          numFaces: 1,
          minFaceDetectionConfidence: 0.5,
          minTrackingConfidence: 0.5,
        });

        console.log("Face LandmarkeråˆæœŸåŒ–å®Œäº†");
      }

      // ãƒ‘ãƒ¼ãƒ„ã®ç¯„å›²ã‚’è¨ˆç®—
      function getPartBounds(landmarks, indices, padding = 15) {
        const points = indices.map((i) => landmarks[i]);
        const xs = points.map((p) => p.x * videoElement.videoWidth);
        const ys = points.map((p) => p.y * videoElement.videoHeight);

        return {
          minX: Math.max(0, Math.min(...xs) - padding),
          maxX: Math.min(videoElement.videoWidth, Math.max(...xs) + padding),
          minY: Math.max(0, Math.min(...ys) - padding),
          maxY: Math.min(videoElement.videoHeight, Math.max(...ys) + padding),
        };
      }

      // ãƒ‘ãƒ¼ãƒ„ã‚’åˆ‡ã‚Šå‡ºã—ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»
      function extractPart(landmarks, partName, indices) {
        const canvas = trayCanvases[partName];
        const ctx = canvas.getContext("2d");
        const bounds = getPartBounds(landmarks, indices);

        const width = bounds.maxX - bounds.minX;
        const height = bounds.maxY - bounds.minY;

        const mirroredX = videoElement.videoWidth - bounds.maxX;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          videoElement,
          mirroredX, bounds.minY, width, height,
          0, 0, canvas.width, canvas.height
        );
      }

      // é¡”ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’å‡¦ç†
      function processFaceLandmarks(results) {
        canvasElement.width = videoElement.videoWidth;
        canvasElement.height = videoElement.videoHeight;

        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

        if (results.faceLandmarks && results.faceLandmarks.length > 0) {
          const landmarks = results.faceLandmarks[0];
          currentLandmarks = landmarks;

          // é¡”ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’æç”»
          canvasCtx.fillStyle = "rgba(0, 255, 0, 0.5)";
          landmarks.forEach((landmark) => {
            const x = landmark.x * canvasElement.width;
            const y = landmark.y * canvasElement.height;
            canvasCtx.beginPath();
            canvasCtx.arc(x, y, 1, 0, 2 * Math.PI);
            canvasCtx.fill();
          });

          status.textContent = "é¡”ã‚’æ¤œå‡ºä¸­ âœ“";
          status.classList.add("active");
        } else {
          currentLandmarks = null;
          status.textContent = "é¡”ãŒè¦‹ãˆã¾ã›ã‚“...";
          status.classList.remove("active");
        }

        canvasCtx.restore();
      }

      // ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒœã‚¿ãƒ³
      captureBtn.addEventListener("click", () => {
        if (!currentLandmarks) {
          alert("é¡”ãŒæ¤œå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“");
          return;
        }

        // å„ãƒ‘ãƒ¼ãƒ„ã‚’åˆ‡ã‚Šå‡ºã—
        Object.entries(FACE_PARTS).forEach(([partName, indices]) => {
          extractPart(currentLandmarks, partName, indices);
        });

        status.textContent = "ã‚­ãƒ£ãƒ—ãƒãƒ£å®Œäº†ï¼ãƒ‘ãƒ¼ãƒ„ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦éŠã¼ã†";
      });

      // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
      function setupDragAndDrop() {
        const draggableParts = document.querySelectorAll(".draggable-part");

        draggableParts.forEach((part) => {
          part.addEventListener("mousedown", startDrag);
          part.addEventListener("touchstart", startDrag, { passive: false });
        });

        function startDrag(e) {
          e.preventDefault();
          const partElement = e.currentTarget;
          const partName = partElement.dataset.part;
          const canvas = trayCanvases[partName];

          // æ–°ã—ã„ãƒ‘ãƒ¼ãƒ„ç”»åƒã‚’ä½œæˆ
          const newPart = document.createElement("img");
          newPart.src = canvas.toDataURL();
          newPart.className = "placed-part dragging";
          newPart.dataset.part = partName;
          newPart.style.width = canvas.width + "px";
          newPart.style.height = canvas.height + "px";

          faceCanvas.appendChild(newPart);
          placedParts.push(newPart);

          const rect = faceCanvas.getBoundingClientRect();
          const clientX = e.clientX || e.touches[0].clientX;
          const clientY = e.clientY || e.touches[0].clientY;

          let offsetX = canvas.width / 2;
          let offsetY = canvas.height / 2;

          newPart.style.left = (clientX - rect.left - offsetX) + "px";
          newPart.style.top = (clientY - rect.top - offsetY) + "px";

          function movePart(e) {
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            newPart.style.left = (clientX - rect.left - offsetX) + "px";
            newPart.style.top = (clientY - rect.top - offsetY) + "px";
          }

          function stopDrag() {
            newPart.classList.remove("dragging");
            document.removeEventListener("mousemove", movePart);
            document.removeEventListener("mouseup", stopDrag);
            document.removeEventListener("touchmove", movePart);
            document.removeEventListener("touchend", stopDrag);

            // é…ç½®æ¸ˆã¿ãƒ‘ãƒ¼ãƒ„ã®ãƒ‰ãƒ©ãƒƒã‚°è¨­å®š
            setupPlacedPartDrag(newPart);
          }

          document.addEventListener("mousemove", movePart);
          document.addEventListener("mouseup", stopDrag);
          document.addEventListener("touchmove", movePart, { passive: false });
          document.addEventListener("touchend", stopDrag);
        }
      }

      // é…ç½®æ¸ˆã¿ãƒ‘ãƒ¼ãƒ„ã®ãƒ‰ãƒ©ãƒƒã‚°
      function setupPlacedPartDrag(part) {
        part.addEventListener("mousedown", startPlacedDrag);
        part.addEventListener("touchstart", startPlacedDrag, { passive: false });

        function startPlacedDrag(e) {
          e.preventDefault();
          e.stopPropagation();
          part.classList.add("dragging");

          const rect = faceCanvas.getBoundingClientRect();
          const partRect = part.getBoundingClientRect();
          const clientX = e.clientX || e.touches[0].clientX;
          const clientY = e.clientY || e.touches[0].clientY;

          let offsetX = clientX - partRect.left;
          let offsetY = clientY - partRect.top;

          function movePart(e) {
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            part.style.left = (clientX - rect.left - offsetX) + "px";
            part.style.top = (clientY - rect.top - offsetY) + "px";
          }

          function stopDrag() {
            part.classList.remove("dragging");
            document.removeEventListener("mousemove", movePart);
            document.removeEventListener("mouseup", stopDrag);
            document.removeEventListener("touchmove", movePart);
            document.removeEventListener("touchend", stopDrag);
          }

          document.addEventListener("mousemove", movePart);
          document.addEventListener("mouseup", stopDrag);
          document.addEventListener("touchmove", movePart, { passive: false });
          document.addEventListener("touchend", stopDrag);
        }
      }

      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒœã‚¿ãƒ³
      document.getElementById("shuffle-btn").addEventListener("click", () => {
        if (!currentLandmarks) {
          alert("å…ˆã«ãƒ‘ãƒ¼ãƒ„ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ãã ã•ã„");
          return;
        }

        // æ—¢å­˜ã®ãƒ‘ãƒ¼ãƒ„ã‚’ã‚¯ãƒªã‚¢
        placedParts.forEach(p => p.remove());
        placedParts = [];

        const faceRect = faceCanvas.getBoundingClientRect();

        // ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®
        Object.entries(trayCanvases).forEach(([partName, canvas]) => {
          const img = document.createElement("img");
          img.src = canvas.toDataURL();
          img.className = "placed-part";
          img.dataset.part = partName;
          img.style.width = canvas.width + "px";
          img.style.height = canvas.height + "px";
          img.style.left = Math.random() * (faceCanvas.offsetWidth - canvas.width) + "px";
          img.style.top = Math.random() * (faceCanvas.offsetHeight - canvas.height) + "px";

          faceCanvas.appendChild(img);
          placedParts.push(img);
          setupPlacedPartDrag(img);
        });
      });

      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
      document.getElementById("reset-btn").addEventListener("click", () => {
        placedParts.forEach(p => p.remove());
        placedParts = [];
      });

      // ä¿å­˜ãƒœã‚¿ãƒ³
      document.getElementById("save-btn").addEventListener("click", () => {
        const saveCanvas = document.createElement("canvas");
        saveCanvas.width = faceCanvas.offsetWidth;
        saveCanvas.height = faceCanvas.offsetHeight;
        const ctx = saveCanvas.getContext("2d");

        // èƒŒæ™¯ã‚’æç”»
        ctx.fillStyle = "#fff5f5";
        ctx.beginPath();
        ctx.ellipse(
          saveCanvas.width / 2,
          saveCanvas.height / 2,
          saveCanvas.width / 2 - 5,
          saveCanvas.height / 2 - 5,
          0, 0, Math.PI * 2
        );
        ctx.fill();

        // ãƒ‘ãƒ¼ãƒ„ã‚’æç”»
        placedParts.forEach(part => {
          const x = parseInt(part.style.left);
          const y = parseInt(part.style.top);
          ctx.drawImage(part, x, y);
        });

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        const link = document.createElement("a");
        link.download = "fukuwarai.png";
        link.href = saveCanvas.toDataURL();
        link.click();
      });

      // ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•
      async function startCamera() {
        await initializeFaceLandmarker();

        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          loading.querySelector("p").textContent = "ã‚«ãƒ¡ãƒ©APIã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“";
          return;
        }

        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: 1280, height: 720 },
          });
          videoElement.srcObject = stream;

          videoElement.addEventListener("loadeddata", () => {
            loading.classList.add("hidden");
            console.log("ã‚«ãƒ¡ãƒ©èµ·å‹•å®Œäº†");

            function onFrame() {
              if (!faceLandmarker) return;

              const startTimeMs = performance.now();

              if (videoElement.currentTime !== lastVideoTime) {
                lastVideoTime = videoElement.currentTime;
                const results = faceLandmarker.detectForVideo(videoElement, startTimeMs);
                processFaceLandmarks(results);
              }

              requestAnimationFrame(onFrame);
            }
            onFrame();
          });
        } catch (error) {
          console.error("ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼:", error);
          loading.querySelector("p").textContent = "ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—: " + error.message;
        }
      }

      setupDragAndDrop();
      startCamera();
    </script>
  </body>
</html>
